---
title: "CA of also data"
author: "Xu Zhang"
date: "2025-05-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## data summary

data summary. Distribution of focus and position of also in HK and GB English.

```{r }
also<-read.csv("also.csv", sep=";", stringsAsFactors=TRUE)

summary(also)

#removing empty rows
cleaned_also <- also[rowSums(is.na(also) | also == "") < ncol(also), ]
cleaned_also$Variety <- droplevels(cleaned_also$Variety)
cleaned_also$Focus <- droplevels(cleaned_also$Focus)
cleaned_also$Position <- droplevels(cleaned_also$Position)
cleaned_also$Relative_Position <- droplevels(cleaned_also$Relative_Position)
cleaned_also$be.also <- droplevels(cleaned_also$be.also)
cleaned_also$R_S_P <- droplevels(cleaned_also$R_S_P)
summary(cleaned_also)

```

## Make a table

```{r}
#  table for focus and position
library("FactoMineR")
library("factoextra")
library(ISLR)
library(tidyverse)
library(Rfast)
library(MASS)
table(cleaned_also$Variety, cleaned_also$Position, cleaned_also$Focus)
df_table <- as.data.frame(table(cleaned_also$Variety, cleaned_also$Position, cleaned_also$Focus))
colnames(df_table) <- c("Variety", "Position", "Focus", "Frequency")


library(ggplot2)
ggplot(df_table, aes(x = Variety, y = Frequency, fill = Position)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ Focus) +  # Creates separate plots for each Focus category
  labs(title = "Distribution by Variety, Position, and Focus",
       x = "Variety",
       y = "Frequency") +
  theme_minimal()


focus_position.table <- prop.table(focus_position.table)
addmargins(hair_eye.table)

```
## multinomial logistic regression model
```{r}
library(nnet)
cleaned_also$NestedVarietyFocus <- interaction(cleaned_also$Variety, cleaned_also$Focus)  # Create nested variable

model_multinom <- multinom(Position ~ Variety + Focus + NestedVarietyFocus, data = cleaned_also)
summary(model_multinom)

```


### testing p-values

```{r}

z_values <- summary(model_multinom)$coefficients / summary(model_multinom)$standard.errors
p_values <- 2 * (1 - pnorm(abs(z_values)))
print(p_values)


```
###displaying results
```{r, echo=FALSE, results='asis'}
install.packages(c("broom", "kableExtra", "knitr"))
library(broom)
library(kableExtra)
library(knitr)# Load package
tidy(model_multinom, conf.int = TRUE, exponentiate = TRUE) %>%
  kable() %>%
  kable_styling("basic", full_width = FALSE)
```

### multinomial model 2 -- only nested results
```{r}
library(nnet)
model_multinom2 <- multinom(Position ~ Variety + Focus, data = cleaned_also)
summary(model_multinom2)
```

# displaying model2
```{r}
z_values <- summary(model_multinom2)$coefficients / summary(model_multinom2)$standard.errors
p_values <- 2 * (1 - pnorm(abs(z_values)))
print(p_values)

```
```{r echo=FALSE, results='asis}
install.packages(c("broom", "kableExtra", "knitr"))
library(broom)
library(kableExtra)
library(knitr)
tidy(model_multinom2, conf.int = TRUE, exponentiate = TRUE) %>%
  kable() %>%
  kable_styling("basic", full_width = FALSE)
```


# plotting effects - post-adjacent
```{r}
library(ggeffects)
ggeffect(model_multinom2, terms = "Variety") %>%
  plot()
```
#plotting effect - focus
```{r}
ggeffect(model_multinom2, terms = "Focus") %>%
  plot()
```

# conditional random forest
```{r}
library(party)
model_crf <- cforest(Position ~ Variety + Focus + NestedVarietyFocus, 
                     data = cleaned_also, 
                     controls = cforest_unbiased(ntree = 500, mtry = 2))  
# Displays importance ranking
library(vip)
vip(model_crf)  # Displays variable importance

```


#simpler model
```{r}

model_multinom2 <- multinom(Position ~ Variety + Focus, data = cleaned_also)
summary(model_multinom2)

```

Standard Errors are excessively high, which suggests unstable parameter estimation. This could be due to:
Multicollinearity: Some variables may be highly correlated.
Overparameterization: Too many interactions that add noise rather than meaningful insights.

#visualizing single tree
```{r}
library(party)

print(getTree(model_crf, 1, labelVar = TRUE))



```
#partial effect plots
```{r}
library(randomForest)
plot(model_crf)



```

```{r}
#model2 predictability 
library(pscl)
pR2(model2)
```
# model 3
```{r}
model3 <- glm(Frequency ~ Focus * Position, data = df_table, family = "poisson")
summary(model3)

```
## model 4 generalized mixed linear model
```{r}
library(lme4)
model4 <- glmer(Frequency ~ Variety * Focus + Variety * Position + (1 | Variety) + (1 | Variety:Focus) + (1 | Variety:Position), data = df_table, family = "poisson")
summary(model4)
```
```{r}
model5 <- glmer(Frequency ~ Variety * Focus + Variety * Position + (1 | Variety), data = df_table, family = "poisson")
summary(model5)
```
#model comparison

```{r}
AIC(model2, model4, model5)
```

# dependency checking
```{r}
library(car)
vif(glm(Frequency ~ Variety + Focus + Position, data = df_table, family = "poisson"))

```

